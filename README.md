# Targeted Genome Assembly Polishing with Long Reads
## Emily Zhang
### BIOF 501, 2024W1
------------------------------------------------------------------------
** The functionality of this workflow is very similar to the targeted mode of GoldPolish (although this verson is substantially simplified). However, the workflow is implemented with NextFlow instead of snakemake. 

## Contents of this Repository:

### Directories
-   `data` : Contains input files for the pipeline, which is a FASTA file representing a simple genome assembly, corresponding long reads in a FASTQ file, and polishing coordinated in a BED file

-   `scripts` : Contains python scripts written for this project. extract-seq.py excises the regions that are specified in the BED file to be polishing and post-processing.py reinserts them into the draft assembly

-   `images`: Contains the images used in this README.

### Files

-   `nextflow.config`: Config file for Nextflow. Contains the Docker container info and settings needed for Singularity 

-   `run_pipeline.nf`: The main workflow file that runs the pipeline via NextFlow

------------------------------------------------------------------------

## Introduction

### Background
Certain regions within whole genome assemblies, such as the terminal overlapping regions of fragmented contigs, often have highly concentrated error rates due to limitations in assembly algorithms [[1](#references)]. These regions can often hinder accurate analysis of the resulting assemblies and thereby, should be corrected prior to downstream analysis. While there are many available tools for genome assembly polishing, such as Racon [[2](#references)], Medaka [[3](#references)], and GoldPolish [[4](#references)], these tools are specifically designed to polish whole genome assemblies. These tools use long-read data to polish assemblies. 

### Purpose
This workflow will allow users to target specific regions of the draft assembly for polishing with long reads. This is critical for producing high-quality and accurate genome assemblies, allowing for robust downstream analysis. 

### Rationale
By targeting genome assembly polishing, this will considerably conserve time and compute-resource usage by allowing users to focus correction efforts on the highest error regions or regions that are important for analysis. 

### Pipeline Overview
The core of the workflow is GoldPolish, which is a long-read polishing algorithm developed by the Birol lab. 

The 4 steps of the pipeline are as follows. 
1. The first step is `extract-seq.py`, which is a helper Python script that was written for this project – here, the coordinates specified in  `polishing_coords.bed` are used to excise the targeted regions in the `golden_path.fa`. 
2. minimap2 [[5](#references)] is used to map the long reads stored in `long_reads.fq` to the draft assembly. This will generate a PAF mapping file [[6](#references)]. 
3. Next, GoldPolish is used to polish the targeted regions with the mapping file generated by minimap2. 
4. Lastly, polished target regions are re-inserted into the draft assembly with another helper Python script, `post-processing.py`

## Usage

### Installation

Installing this pipeline requires `git` , `nextflow`, and `singularity`

Click [here](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git) for instruction to install `git`

Click [here](https://www.nextflow.io/docs/latest/getstarted.html) for instruction to install `nextflow`

Click [here](https://docs.sylabs.io/guides/3.0/user-guide/installation.html) for instruction to install `singularity`

After installing all three, clone the repository by running the following command in a terminal:

```         
git clone https://github.com/emilyyzhangg/target_polish.git 
```

The pipeline use the following containers from [DockerHub](https://hub.docker.com/):

```
- biocontainers/minimap2:2.28--he4a0461_3
- biocontainers/goldrush:1.2.1--py38h2123bcc_2
```

Nextflow will automatically download all of the containers and run the appropriate steps of the workflow inside them, so you do not need to manually download them. Just make sure `singularity` is properly installed and is in your PATH.

### Data Used

For this workflow, a subset of _Caenorhabditis elegans_ reads are used. The SRA accession of this dataset is SRR10028109. The draft assembly was generated from the long reads using Flye [[7](#references)]. The BED file [[8](#references)] was generated by hand. Since the data itself is merely there to demonstrate the usage of this pipeline, the polishing coordinates were arbitrarily chosen. 

### Running the Pipeline

From your home directory, enter this repository directory with the following command:

```
cd ./target_polish
```

The pipeline can then be run with the following command:

```         
nextflow run run_pipeline.nf
```

The output files will be generate in a new sub-directory:

`output/`

## Expected Output

The output of the workflow is a polished assembly in FASTA format that is stored in the file: `output/polished_assembly.fa`


## Conclusion

This worflow is a effective solution for targeting polishing of genome assemblies using long reads. It will allow users to directly address regions in draft assemblies with higher error rates in a computationally lean mannerGoldPolish-Target emerges as a powerful, efficient, and flexible solution for targeted polishing genome assemblies using long reads. 

## References
[1] Jayakumar V, Sakakibara Y. Comprehensive evaluation of non-hybrid genome assembly tools for third-generation PacBio long-read sequence data. Brief Bioinform. 2019 May 21;20(3):866–76.

[2] Vaser R, Sović I, Nagarajan N, Šikić M. Fast and accurate de novo genome assembly from long uncorrected reads. Genome Res. 2017 May;27(5):737–46.

[3] medaka: Sequence correction provided by ONT Research. [Internet]. [cited 2024 Nov 30]. Available from: https://github.com/nanoporetech/medaka

[4] Wong J, Coombe L, Nikolić V, Zhang E, Nip KM, Sidhu P, et al. Linear time complexity de novo long read genome assembly with GoldRush. Nat Commun. 2023 May 22;14(1):2906

[5] Li H. Minimap2: pairwise alignment for nucleotide sequences. Birol I, editor. Bioinformatics. 2018 Sep 15;34(18):3094–100. 

[6] PAF: a Pairwise mApping Format [Internet]. [cited 2024 Nov 30]. Available from: https://github.com/lh3/miniasm/blob/master/PAF.md

[7] Kolmogorov, M., Yuan, J., Lin, Y. et al. Assembly of long, error-prone reads using repeat graphs. Nat Biotechnol 37, 540–546 (2019). https://doi.org/10.1038/s41587-019-0072-8

[8] BED format [Internet]. [cited 2024 Nov 30]. Available from: https://genome.cse.ucsc.edu/FAQ/FAQformat.html#format1